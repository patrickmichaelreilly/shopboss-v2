@model ShopBoss.Web.Services.WorkspaceListResult

@{
    ViewData["Title"] = "SmartSheet Project Migration Tool";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <h2>SmartSheet Project Migration Tool</h2>
    
    @if (!string.IsNullOrEmpty(ViewBag.Error))
    {
        <div class="alert alert-danger" role="alert">
            @ViewBag.Error
        </div>
    }
    
    <!-- Section 1: Sheet Selection -->
    <div class="card mb-3">
        <div class="card-header">
            <h4>1. Select Source Sheet</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>Active Jobs</h5>
                    <div id="activeJobsList" class="list-group" style="max-height: 300px; overflow-y: auto;">
                        @if (Model?.ActiveJobs != null)
                        {
                            @foreach (var sheet in Model.ActiveJobs)
                            {
                                <a href="#" class="list-group-item list-group-item-action" 
                                   data-sheet-id="@sheet.Id" onclick="selectSheet(@sheet.Id, '@sheet.Name'); return false;">
                                    @sheet.Name
                                    <small class="text-muted d-block">Modified: @sheet.ModifiedAt?.ToString("yyyy-MM-dd HH:mm")</small>
                                </a>
                            }
                        }
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>Archived Jobs</h5>
                    <div id="archivedJobsList" class="list-group" style="max-height: 300px; overflow-y: auto;">
                        @if (Model?.ArchivedJobs != null)
                        {
                            @foreach (var sheet in Model.ArchivedJobs)
                            {
                                <a href="#" class="list-group-item list-group-item-action" 
                                   data-sheet-id="@sheet.Id" onclick="selectSheet(@sheet.Id, '@sheet.Name'); return false;">
                                    @sheet.Name
                                    <small class="text-muted d-block">Modified: @sheet.ModifiedAt?.ToString("yyyy-MM-dd HH:mm")</small>
                                </a>
                            }
                        }
                    </div>
                </div>
            </div>
            <button class="btn btn-primary mt-3" onclick="loadSheetDetails()" disabled id="loadButton">
                Load Selected Sheet
            </button>
        </div>
    </div>
    
    <!-- Section 2: Sheet Analysis -->
    <div class="card mb-3" id="sheetAnalysis" style="display: none;">
        <div class="card-header">
            <h4>2. Sheet Analysis</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h5>Sheet Summary</h5>
                    <div id="sheetSummary" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Attachments (<span id="attachmentCount">0</span>)</h5>
                    <div id="attachmentList" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Comments/History (<span id="commentCount">0</span>)</h5>
                    <div id="commentList" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Timeline Reconstruction Preview -->
            <div class="mt-3">
                <h5>Reconstructed Timeline</h5>
                <div id="timelinePreview" class="timeline-container border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                    <!-- Populated by JavaScript using timeline partial styling -->
                </div>
            </div>
            
            <button class="btn btn-secondary mt-3" onclick="showProjectForm()">
                Proceed to Create Project
            </button>
        </div>
    </div>
    
    <!-- Section 3: Project Creation Form -->
    <div class="card mb-3" id="projectCreation" style="display: none;">
        <div class="card-header">
            <h4>3. Create ShopBoss Project</h4>
        </div>
        <div class="card-body">
            <form id="projectForm">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="projectId" class="form-label">Project ID</label>
                            <input type="text" class="form-control" id="projectId" name="projectId" required>
                        </div>
                        <div class="mb-3">
                            <label for="projectName" class="form-label">Project Name</label>
                            <input type="text" class="form-control" id="projectName" name="projectName" required>
                        </div>
                        <div class="mb-3">
                            <label for="projectManager" class="form-label">Project Manager</label>
                            <input type="text" class="form-control" id="projectManager" name="projectManager">
                        </div>
                        <div class="mb-3">
                            <label for="projectContact" class="form-label">Project Contact</label>
                            <input type="text" class="form-control" id="projectContact" name="projectContact">
                        </div>
                        <div class="mb-3">
                            <label for="projectContactPhone" class="form-label">Contact Phone</label>
                            <input type="text" class="form-control" id="projectContactPhone" name="projectContactPhone">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="projectContactEmail" class="form-label">Contact Email</label>
                            <input type="email" class="form-control" id="projectContactEmail" name="projectContactEmail">
                        </div>
                        <div class="mb-3">
                            <label for="projectAddress" class="form-label">Project Address</label>
                            <input type="text" class="form-control" id="projectAddress" name="projectAddress">
                        </div>
                        <div class="mb-3">
                            <label for="generalContractor" class="form-label">General Contractor</label>
                            <input type="text" class="form-control" id="generalContractor" name="generalContractor">
                        </div>
                        <div class="mb-3">
                            <label for="installer" class="form-label">Installer</label>
                            <input type="text" class="form-control" id="installer" name="installer">
                        </div>
                        <div class="mb-3">
                            <label for="targetInstallDate" class="form-label">Target Install Date</label>
                            <input type="date" class="form-control" id="targetInstallDate" name="targetInstallDate">
                        </div>
                        <div class="mb-3">
                            <label for="projectCategory" class="form-label">Project Category</label>
                            <select class="form-select" id="projectCategory" name="projectCategory" required>
                                <option value="0">Standard Products</option>
                                <option value="1">Custom Products</option>
                                <option value="2">Small Job</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
            
            <button class="btn btn-success mt-3" onclick="importProject()">
                Import Project to ShopBoss
            </button>
        </div>
    </div>
    
    <!-- Section 4: Import Results -->
    <div class="card" id="importResults" style="display: none;">
        <div class="card-header">
            <h4>4. Import Results</h4>
        </div>
        <div class="card-body">
            <div id="resultsContent">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/smartsheet-migration.js"></script>
}

<style>
    .timeline-event {
        border-left: 3px solid #0d6efd;
        padding-left: 15px;
        margin-bottom: 15px;
    }
    
    .timeline-event .badge {
        margin-right: 10px;
    }
    
    .list-group-item.active {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
</style>