@model ShopBoss.Web.Services.TimelineData

@{
    var projectId = Model.Project.Id;
    var timelineId = ViewData["TimelineId"]?.ToString() ?? $"timeline-{projectId}";
}

<div id="@timelineId" class="timeline-container border rounded p-3">
    @if (Model.TaskBlocks.Any() || Model.UnblockedEvents.Any())
    {
        <!-- TaskBlocks with their events (recursive nesting) -->
        @foreach (var block in Model.TaskBlocks)
        {
            ViewData["NestingLevel"] = 0;
            @await Html.PartialAsync("_TaskBlockRecursive", block, ViewData)
        }

        <!-- Unblocked Events -->
        @foreach (var evt in Model.UnblockedEvents)
        {
            <div class="timeline-event unblocked-event" data-event-id="@evt.Id">
                @{
                    var viewData = new ViewDataDictionary(ViewData) { ["ProjectId"] = projectId };
                }
                @await Html.PartialAsync("_TimelineEvent", evt, viewData)
            </div>
        }
    }
    else
    {
        <div class="text-center text-muted py-4">
            <i class="fas fa-history fa-2x mb-2"></i>
            <p>No timeline events found</p>
            <small>Events will appear here after Smartsheet data is imported</small>
        </div>
    }
</div>

@* Styles moved to site.css *@
