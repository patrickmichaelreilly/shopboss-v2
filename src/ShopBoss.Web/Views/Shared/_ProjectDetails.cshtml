@model ShopBoss.Web.Models.Project

<!-- Project Information Section -->
<div class="card mb-3">
    <div class="card-body p-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="d-flex align-items-center">
                <i class="fas fa-info-circle me-2 text-muted"></i>
                <small class="fw-bold">Project Information</small>
            </div>
            <div id="edit-buttons-@Model.Id" class="d-none">
                <button type="button" class="btn btn-sm btn-success me-1" onclick="saveProjectEdit('@Model.Id')">
                    <i class="fas fa-save me-1"></i>Save
                </button>
                <button type="button" class="btn btn-sm btn-secondary" onclick="cancelProjectEdit('@Model.Id')">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
            </div>
        </div>
        
        <!-- Display Mode -->
        <div id="project-display-@Model.Id">
            <table class="table table-sm table-borderless mb-0">
                <tbody>
                    <!-- Left: Customer Info, Right: Internal Info -->
                    <tr>
                        <td width="120" class="text-muted ps-3">Address:</td>
                        <td>@(Model.ProjectAddress ?? "-")</td>
                        <td width="120" class="text-muted">Bid Date:</td>
                        <td>@(Model.BidRequestDate?.ToString("MM/dd/yy") ?? "-")</td>
                    </tr>
                    <tr>
                        <td class="text-muted ps-3">Contractor:</td>
                        <td>@(Model.GeneralContractor ?? "-")</td>
                        <td class="text-muted">PM:</td>
                        <td>@(Model.ProjectManager ?? "-")</td>
                    </tr>
                    <tr>
                        <td class="text-muted ps-3">Contact:</td>
                        <td>@(Model.ProjectContact ?? "-")</td>
                        <td class="text-muted">Installer:</td>
                        <td>@(Model.Installer ?? "-")</td>
                    </tr>
                    <tr>
                        <td class="text-muted ps-3">Email:</td>
                        <td>@(Model.ProjectContactEmail ?? "-")</td>
                        <td class="text-muted">Category:</td>
                        <td><span class="badge bg-secondary">@Model.ProjectCategory</span></td>
                    </tr>
                    <tr>
                        <td class="text-muted ps-3">Phone:</td>
                        <td>@(Model.ProjectContactPhone ?? "-")</td>
                        <td class="text-muted">SmartSheet:</td>
                        <td>
                            @if (Model.SmartSheetId.HasValue)
                            {
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2" style="font-size: 0.7em;">Linked</span>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="unlinkSmartSheet('@Model.Id')">
                                        <i class="fas fa-unlink me-1"></i>Unlink
                                    </button>
                                </div>
                            }
                            else
                            {
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-secondary me-2" style="font-size: 0.7em;">Not Linked</span>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="showSmartSheetLinking('@Model.Id')">
                                        <i class="fas fa-link me-1"></i>Link
                                    </button>
                                </div>
                            }
                        </td>
                    </tr>
                    
                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <tr><td colspan="4" class="py-2"></td></tr>
                        <tr>
                            <td class="text-muted align-top ps-3">Notes:</td>
                            <td colspan="3">@Model.Notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
        <!-- Edit Mode -->
        <div id="project-edit-@Model.Id" class="d-none">
            @await Html.PartialAsync("_ProjectForm", Model)
        </div>
    </div>
</div>


<!-- Files Section -->
<div class="card mb-3">
    <div class="card-body p-2">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="d-flex align-items-center">
            <i class="fas fa-paperclip me-2 text-muted"></i>
            <small class="fw-bold">Files (@Model.Attachments.Count)</small>
        </div>
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="document.getElementById('fileInputHidden-@Model.Id').click();">
            <i class="fas fa-upload me-1"></i>Upload
        </button>
        <input type="file" id="fileInputHidden-@Model.Id" class="d-none" multiple 
               onchange="uploadFilesDirectly('@Model.Id', this)">
    </div>
    
    <div id="files-@Model.Id" style="max-height: 300px; overflow-y: auto;">
        @if (Model.Attachments.Any())
        {
            @foreach (var attachment in Model.Attachments.OrderByDescending(a => a.UploadedDate))
            {
                <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                    <div class="d-flex align-items-center flex-grow-1">
                        <i class="fas fa-file text-muted me-2" style="font-size: 0.9em;"></i>
                        <a href="@Url.Action("DownloadFile", new { id = attachment.Id })" 
                           class="text-decoration-none me-2" style="font-size: 0.9em;">
                            @attachment.OriginalFileName
                        </a>
                        <select class="form-select form-select-sm d-inline-block w-auto" 
                                onchange="updateFileCategory('@attachment.Id', this.value)" 
                                style="font-size: 0.8em;">
                            @{
                                var categories = new[] { "Schematic", "Correspondence", "Invoice", "Proof", "Other" };
                                foreach (var cat in categories)
                                {
                                    <option value="@cat" selected="@(attachment.Category == cat)">@cat</option>
                                }
                            }
                        </select>
                        <small class="text-muted ms-2">
                            @(attachment.FileSize / 1024) KB • @attachment.UploadedDate.ToString("MM/dd/yy")
                        </small>
                    </div>
                    <button type="button" class="btn btn-sm btn-link text-danger p-0 ms-2" 
                            onclick="deleteFile('@attachment.Id', '@Model.Id')" title="Delete">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            }
        }
        else
        {
            <div class="text-center text-muted py-3">
                <small>No files uploaded</small>
            </div>
        }
    </div>
    </div>
</div>

<!-- Purchase Orders Section -->
<div class="card mb-3">
    <div class="card-body p-2">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="d-flex align-items-center">
            <i class="fas fa-shopping-cart me-2 text-muted"></i>
            <small class="fw-bold">Purchase Orders (@Model.PurchaseOrders.Count)</small>
        </div>
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="showCreatePurchaseOrder('@Model.Id')">
            <i class="fas fa-plus me-1"></i>Add
        </button>
    </div>
    
    <div id="purchase-orders-@Model.Id" style="max-height: 300px; overflow-y: auto;">
        @if (Model.PurchaseOrders.Any())
        {
            @foreach (var purchaseOrder in Model.PurchaseOrders)
            {
                <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                    <div class="d-flex align-items-center flex-grow-1">
                        <i class="fas fa-file-invoice text-muted me-2" style="font-size: 0.9em;"></i>
                        <div style="font-size: 0.9em;">
                            <strong>@purchaseOrder.PurchaseOrderNumber</strong>
                            <small class="text-muted ms-2">• @purchaseOrder.VendorName</small>
                            <small class="text-muted ms-2">• <span class="badge bg-secondary" style="font-size: 0.7em;">@purchaseOrder.Status</span></small>
                            <small class="text-muted ms-2">• @purchaseOrder.OrderDate.ToString("MM/dd/yy")</small>
                        </div>
                    </div>
                    <div class="d-flex">
                        <button type="button" class="btn btn-sm btn-link text-primary p-0 me-2" 
                                onclick="editPurchaseOrder('@purchaseOrder.Id', '@Model.Id')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-link text-danger p-0" 
                                onclick="deletePurchaseOrder('@purchaseOrder.Id', '@Model.Id')" title="Delete">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center text-muted py-3">
                <small>No purchase orders created</small>
            </div>
        }
    </div>
    </div>
</div>

<!-- Project Timeline Section -->
<div class="card mb-3">
    <div class="card-body p-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="d-flex align-items-center">
                <i class="fas fa-history me-2 text-muted"></i>
                <small class="fw-bold">Project Timeline (@Model.Events.Count)</small>
            </div>
        </div>
        
        <div id="timeline-container-@Model.Id">
            @{
                ViewData["TimelineId"] = $"timeline-{Model.Id}";
            }
            <!-- Timeline will be loaded via AJAX -->
            <div class="text-center text-muted py-3">
                <i class="fas fa-spinner fa-spin me-1"></i>Loading timeline...
            </div>
        </div>
    </div>
</div>

<!-- Work Orders Section -->
<div class="card">
    <div class="card-body p-2">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="d-flex align-items-center">
            <i class="fas fa-briefcase me-2 text-muted"></i>
            <small class="fw-bold">Work Orders (@(Model.WorkOrders.Count + Model.CustomWorkOrders.Count))</small>
        </div>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-success" onclick="showAssociateWorkOrders('@Model.Id')" title="Add Manufacturing Work Order">
                <i class="fas fa-plus me-1"></i>Add WO
            </button>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="showCreateCustomWorkOrder('@Model.Id')" title="Add Custom Work Order">
                <i class="fas fa-plus me-1"></i>Custom
            </button>
        </div>
    </div>
    
    <div id="work-orders-@Model.Id" style="max-height: 300px; overflow-y: auto;">
        @{
            var hasAnyWorkOrders = Model.WorkOrders.Any() || Model.CustomWorkOrders.Any();
        }
        @if (hasAnyWorkOrders)
        {
            @* Regular Manufacturing Work Orders *@
            @foreach (var workOrder in Model.WorkOrders)
            {
                <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-cog text-primary me-2" style="font-size: 0.8em;" title="Manufacturing Work Order"></i>
                        <div style="font-size: 0.9em;">
                            <a href="@Url.Action("ModifyWorkOrder", "Admin", new { id = workOrder.Id })" 
                               class="text-decoration-none fw-bold">@workOrder.Name</a>
                            <small class="text-muted ms-2">• Imported: @workOrder.ImportedDate.ToString("MM/dd/yy")</small>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-link text-danger p-0" 
                            onclick="detachWorkOrder('@workOrder.Id', '@Model.Id')" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            }
            
            @* Custom Work Orders *@
            @foreach (var customWorkOrder in Model.CustomWorkOrders)
            {
                <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-wrench text-info me-2" style="font-size: 0.8em;" title="Custom Work Order"></i>
                        <div style="font-size: 0.9em;">
                            <span class="fw-bold">@customWorkOrder.Name</span>
                            <small class="text-muted ms-2">• Created: @customWorkOrder.CreatedDate.ToString("MM/dd/yy")</small>
                        </div>
                    </div>
                    <div class="d-flex">
                        <button type="button" class="btn btn-sm btn-link text-primary p-0 me-2" 
                                onclick="editCustomWorkOrder('@customWorkOrder.Id', '@Model.Id')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-link text-danger p-0" 
                                onclick="deleteCustomWorkOrder('@customWorkOrder.Id', '@Model.Id')" title="Delete">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center text-muted py-3">
                <small>No work orders associated</small>
            </div>
        }
    </div>
    </div>
</div>